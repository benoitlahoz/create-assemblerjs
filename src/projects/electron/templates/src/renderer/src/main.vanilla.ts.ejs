import { AbstractAssemblage, Assemblage, Assembler, Context, AssemblerContext } from 'assemblerjs';
import { Task } from '@assemblerjs/core';
import { router } from '@/windows/router';
import App from './App';
import { initializeContext } from '@/renderer/providers/AssemblerProvider';

@Assemblage()
class MainApp implements AbstractAssemblage {
  constructor(@Context() private context: AssemblerContext) {}

  public async onInit(): Promise<void> {
    // Initialize global context for vanilla JS
    initializeContext(this.context);
    
    await router.isReady();
    console.log('Vue Router initialized');
<% } else if (isReact()) { %>    const container = document.getElementById('root');
    if (!container) {
      throw new Error('Root element not found');
    }

    const root = createRoot(container);
    root.render(
      <RouterProvider router={router}>
        <App />
      </RouterProvider>
    );
    console.log('React Router initialized');
<% } else if (isSolid()) { %>    const root = document.getElementById('app');
    if (!root) {
      throw new Error('Root element not found');
    }

    render(() => <AppRouter />, root);
    console.log('Solid Router initialized');
<% } else if (isSvelte()) { %>    const target = document.getElementById('app');
    if (!target) {
      throw new Error('Root element not found');
    }

    this.app = new App({
      target,
      props: {
        router: router
      }
    });
    console.log('Svelte Router initialized');
<% } else { %>    // Initialize vanilla JavaScript app with router
    const appElement = document.getElementById('app');
    if (!appElement) {
      throw new Error('Root element not found');
    }

import { AbstractAssemblage, Assemblage, Assembler, Context, AssemblerContext } from 'assemblerjs';
import { Task } from '@assemblerjs/core';
import { router } from '@/windows/router';
import App from './App';
import { initializeContext } from '@/renderer/providers/AssemblerProvider';

@Assemblage()
class MainApp implements AbstractAssemblage {
  constructor(@Context() private context: AssemblerContext) {}

  public async onInit(): Promise<void> {
    // Initialize global context for vanilla JS
    initializeContext(this.context);

    // Initialize vanilla JavaScript app with router
    const appElement = document.getElementById('app');
    if (!appElement) {
      throw new Error('Root element not found');
    }

    const app = new App();
    app.init(router);
    appElement.appendChild(app.render());
    console.log('Vanilla Router initialized');
  }
}

const task = Task.of(() => Assembler.build(MainApp));
task
  .fork()
  .then(() => {
    console.log('Vanilla app was successfully built and mounted.');
  })
  .catch((error) => {
    console.error('There was an error during Vanilla app build:', error);
  });
