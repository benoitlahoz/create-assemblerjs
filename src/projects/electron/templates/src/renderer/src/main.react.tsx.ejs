import { AbstractAssemblage, Assemblage, Assembler, Context, AssemblerContext } from 'assemblerjs';
import { Task } from '@assemblerjs/core';
import React from 'react';
import { createRoot } from 'react-dom/client';
import { RouterProvider } from 'react-router-dom';
import { router } from '@/windows/router';
import { AssemblerProvider } from '@/renderer/providers/AssemblerProvider';

@Assemblage()
class MainApp implements AbstractAssemblage {
  constructor(@Context() private context: AssemblerContext) {}

  public async onInit(): Promise<void> {
    const container = document.getElementById('root');
    if (!container) {
      throw new Error('Root element not found');
    }

    const root = createRoot(container);
    root.render(
      <AssemblerProvider context={this.context}>
        <RouterProvider router={router} />
      </AssemblerProvider>
    );
    console.log('React Router initialized');
  }
}

const task = Task.of(() => Assembler.build(MainApp));
const task = Task.of(() => Assembler.build(MainApp));
task
  .fork()
  .then(() => {
    console.log('React app was successfully built and mounted.');
  })
  .catch((error) => {
    console.error('There was an error during React app build:', error);
  });
