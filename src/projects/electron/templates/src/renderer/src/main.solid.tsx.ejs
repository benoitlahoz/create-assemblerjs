import { AbstractAssemblage, Assemblage, Assembler, Context, AssemblerContext } from 'assemblerjs';
import { Task } from '@assemblerjs/core';
import { render } from 'solid-js/web';
import { AppRouter } from '@/windows/router';
import { AssemblerProvider } from '@/renderer/providers/AssemblerProvider';

@Assemblage()
class MainApp implements AbstractAssemblage {
  constructor(@Context() private context: AssemblerContext) {}

  public async onInit(): Promise<void> {
    const root = document.getElementById('app');
    if (!root) {
      throw new Error('Root element not found');
    }

    render(() => (
      <AssemblerProvider context={this.context}>
        <AppRouter />
      </AssemblerProvider>
    ), root);
    console.log('Solid Router initialized');
  }
}

const task = Task.of(() => Assembler.build(MainApp));
task
  .fork()
  .then(() => {
    console.log('Solid app was successfully built and mounted.');
  })
  .catch((error) => {
    console.error('There was an error during Solid app build:', error);
  });
