import { AbstractAssemblage, Assemblage, Assembler, Context, AssemblerContext } from 'assemblerjs';
import { Task } from '@assemblerjs/core';
import { createApp } from 'vue';
import App from './App.vue';

import { router } from '@/windows/router';

import { ContextInjectionKey } from '@/renderer/constants/injection.keys';

@Assemblage()
class MainApp implements AbstractAssemblage {
  constructor(@Context() private context: AssemblerContext) {}

  public async onInit(): Promise<void> {
    const app = createApp(App);
    app.use(router);
    app.provide(ContextInjectionKey, this.context);
    app.mount('#app');
    
    await router.isReady();
    console.log('Vue Router initialized');
  }
}

const task = Task.of(() => Assembler.build(MainApp));
task
  .fork()
  .then(() => {
    console.log('Vue app was successfully built and mounted.');
  })
  .catch((error) => {
    console.error('There was an error during Vue app build:', error);
  });
